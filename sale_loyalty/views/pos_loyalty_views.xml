<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--<record id="view_partner_property_form" model="ir.ui.view">-->
        <!--<field name="name">res.partner.form.inherit</field>-->
        <!--<field name="model">res.partner</field>-->
        <!--<field name="inherit_id" ref="base.view_partner_form"/>-->
        <!--<field name="arch" type="xml">-->
            <!--<xpath expr="//notebook" position="inside">-->
                <!--<page string="Loyalty">-->
                    <!--<group>-->
                        <!--<group>-->
                            <!--<field name="loyalty_points"/>-->
                        <!--</group>-->
                    <!--</group>-->
                <!--</page>-->
            <!--</xpath>-->
        <!--</field>-->
    <!--</record>-->
    <record id="view_partner_property_form" model="ir.ui.view">
        <field name="name">res.partner.form.inherit</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="membership.view_partner_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='free_member']/.." position="inside">
                <field name="loyalty_points"/>
                <field name="membership_id" readonly="1"/>
            </xpath>
        </field>
    </record>

    <record id="view_partner_property_kanban" model="ir.ui.view">
        <field name="name">res.partner.kanban.inherit</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.res_partner_kanban_view"/>
        <field name="arch" type="xml">
            <xpath expr="//div[contains(@class, 'oe_kanban_details')]/ul" position="inside">
                <li class="o_text_overflow"><field name="membership_id"/></li>
            </xpath>
        </field>
    </record>

    <record id="view_loyalty_program_form" model="ir.ui.view">
        <field name="name">sale.loyalty.program.form</field>
        <field name="model">sale.loyalty.program</field>
        <field name="arch" type="xml">
            <form string="Loyalty Program">
                <sheet>
                    <div class="oe_title">
                        <label class="oe_edit_only" for="name" string="Loyalty Program Name"/>
                        <h1><field name="name"/></h1>
                    </div>

                    <group col="4">
                        <field name="pp_currency"/>
                        <field name="pp_product"/>
                        <field name="pp_order"/>
                        <field name="rounding" invisible="1"/>
                    </group>

                    <separator string="Rules" colspan="4"/>
                    <p>Rules change how loyalty points are earned for specific products or categories</p>
                    <field name="rule_ids" colspan="4" nolabel="1">
                        <tree string="Rules">
                            <field name="name" />
                            <field name="pp_product"/>
                            <field name="pp_currency"/>
                            <field name="cumulative" invisible="1"/>
                        </tree>
                    </field>

                    <separator string="Rewards" colspan="4"/>
                    <p>Reward the customer with gifts or discounts for loyalty points</p>
                    <field name="reward_ids" colspan="4" nolabel="1">
                        <tree string="Rewards">
                            <field name="name"/>
                            <field name="reward_type"/>
                        </tree>
                    </field>

                </sheet>
            </form>
        </field>
    </record>
    
    <record id="view_loyalty_rule_form" model="ir.ui.view">
        <field name="name">sale.loyalty.rule.form</field>
        <field name="model">sale.loyalty.rule</field>
        <field name="arch" type="xml">
            <form string="Loyalty Rule">
                <div class="oe_title">
                    <label class="oe_edit_only" for="name" string="Rule Name"/>
                    <h1><field name="name"/></h1>
                </div>
                <group>
                    <group>
                        <field name="rule_type" />
                    </group>
                    <group>
                        <field name="product_id" attrs="{'invisible':[('rule_type','!=','product')], 'required':[('rule_type','==','product')]}"/>
                        <field name="category_id" attrs="{'invisible':[('rule_type','!=','category')], 'required':[('rule_type','==','category')]}"/>
                    </group>
                </group>
                <group col="6">
                    <!--<field name="pp_product" digits="[16,5]"/>-->
                    <!--<field name="pp_currency" digits="[16,5]"/>-->
                    <field name="pp_product"/>
                    <field name="pp_currency"/>
                    <field name="cumulative" invisible="1"/>
                </group>
            </form>
        </field>
    </record>

    <record id="view_loyalty_reward_form" model="ir.ui.view">
        <field name="name">sale.loyalty.reward.form</field>
        <field name="model">sale.loyalty.reward</field>
        <field name="arch" type="xml">
            <form string="Loyalty Reward">
                <div class="oe_title">
                    <label class="oe_edit_only" for="name" string="Reward Name"/>
                    <h1><field name="name"/></h1>
                </div>
                <group>
                    <field name="reward_type" />
                </group>
                <group >
                    <field name="gift_product_id" options="{'no_create': True, 'no_open': True}"
                           attrs="{'invisible':[('reward_type','!=','gift')], 'required':[('reward_type','=','gift')]}"/>
                    <field name="membership_id" options="{'no_create': True, 'no_open': True}"
                           attrs="{'invisible':[('reward_type','!=','discount')],
                                   'required':[('reward_type','=','discount'),
                                                '|', '&amp;', ('type','=','product'), ('discount_product_id','=',False),
                                                     '&amp;', ('type','=','category'), ('discount_category_id','=',False)]}"/>
                    <field name="type" attrs="{'invisible':[('reward_type','!=','discount')], 'required':[('reward_type','=','discount')]}"/>
                    <label for="discount" attrs="{'invisible':[('reward_type','!=','discount')]}"/>
                    <div class="o_row" attrs="{'invisible':[('reward_type','!=','discount')]}">
                        <field name="discount"/>
                        <label for="discount" string="%"/>
                    </div>
                    <field name="discount_product_id" options="{'no_create': True, 'no_open': True}"
                           attrs="{'invisible':['|', ('reward_type','!=','discount'), ('type','!=','product')],
                                   'required':[('reward_type','=','discount'), ('type','=','product'), ('membership_id','=',False)]}"/>
                    <field name="discount_category_id" options="{'no_create': True, 'no_open': True}"
                           attrs="{'invisible':['|', ('reward_type','!=','discount'), ('type','!=','category')],
                                   'required':[('reward_type','=','discount'), ('type','=','category'), ('membership_id','=',False)]}"/>
                    <field name="point_product_id" options="{'no_create': True, 'no_open': True}"
                           attrs="{'invisible':[('reward_type','!=','resale')], 'required':[('reward_type','==','resale')]}"/>
                </group>
                <group>
                    <field name="point_cost" attrs="{'invisible':[('reward_type','=','resale')] }" />
                    <field name="minimum_points" />
                </group>
            </form>
        </field>
    </record>

    <record id="view_loyalty_program_tree" model="ir.ui.view">
        <field name="name">sale.loyalty.program.form</field>
        <field name="model">sale.loyalty.program</field>
        <field name="arch" type="xml">
            <tree string="Loyalty Programs">
                <field name="name"/>
            </tree>
        </field>
    </record>

    <record id="action_loyalty_program_form" model="ir.actions.act_window">
        <field name="name">Loyalty Programs</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">sale.loyalty.program</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
                Click to create a Loyalty Program.
            </p><p>
                Loyalty Programs allows you customer to earn points
                and rewards when doing business at your shops.
            </p>
        </field>
    </record>

    <menuitem parent="sale.menu_sale_config" action="action_loyalty_program_form" id="menu_loyalty_program" sequence="30"/>
</odoo>
